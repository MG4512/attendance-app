<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Attendance Tracker 2026</title>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
    h1 { text-align: center; color: #2c3e50; }
    .container { display:none; max-width: 95%; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
    .login { text-align:center; margin-top:50px; }
    input, button, select { padding: 6px; margin: 4px; }
    .table-container { overflow-x:auto; margin-top:16px; border:1px solid #ccc; border-radius:6px; }
    table { border-collapse: collapse; width:max-content; min-width:100%; font-size:11px; }
    th, td { border:1px solid #ccc; padding:4px; text-align:center; white-space:nowrap; }
    th { background:#34495e; color:#fff; }
    .status-present { background:#2ecc71; color:#fff; }
    .status-absent { background:#e74c3c; color:#fff; }
    .status-leave { background:#e67e22; color:#fff; }
  </style>
</head>
<body>
  <!-- Login Section -->
  <div class="login" id="loginSection">
    <h2>Employee Login</h2>
    <input type="email" id="email" placeholder="Email" /><br/>
    <input type="password" id="password" placeholder="Password" /><br/>
    <button onclick="login()">Login</button>
    <button onclick="signup()">Sign Up</button>
  </div>

  <!-- Attendance App -->
  <div class="container">
    <h1>Attendance Tracker â€“ Year 2026</h1>
    <div>
      <label for="monthSelect">Select Month:</label>
      <select id="monthSelect">
        <option value="0">January</option>
        <option value="1">February</option>
        <option value="2">March</option>
        <option value="3">April</option>
        <option value="4">May</option>
        <option value="5">June</option>
        <option value="6">July</option>
        <option value="7">August</option>
        <option value="8">September</option>
        <option value="9">October</option>
        <option value="10">November</option>
        <option value="11">December</option>
      </select>
    </div>
    <div id="monthSection">
      <h2 id="monthTitle"></h2>
      <div class="table-container">
        <table id="attendanceTable">
          <thead><tr id="tableHeadRow"><th>Date</th><th>Status</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Firebase Config (must come before your custom code) -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCX_604u0liK0AaFcDt3dwy_EdXBLGXufk",
      authDomain: "attendance-tracker-348d3.firebaseapp.com",
      projectId: "attendance-tracker-348d3",
      storageBucket: "attendance-tracker-348d3.appspot.com",
      messagingSenderId: "34779168212",
      appId: "1:34779168212:web:2387945e87b19e51e86a41"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>

  <!-- Your custom attendance code -->
  <script>
    const year = 2026;
    const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    const daysInMonth = [31,28,31,30,31,30,31,31,30,31,30,31];
    if ((year % 4 === 0 && year % 100 !== 0) || year % 400 === 0) daysInMonth[1] = 29;

    let currentUID = null;

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(user => {
          currentUID = user.user.uid;
          document.getElementById("loginSection").style.display = "none";
          document.querySelector(".container").style.display = "block";
          renderMonth(parseInt(document.getElementById("monthSelect").value, 10));
        })
        .catch(err => alert("Login failed: " + err.message));
    }

    function signup() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(user => alert("Account created! Please login."))
        .catch(err => alert("Signup failed: " + err.message));
    }

    function setAttendance(dayKey, value) {
      db.collection("attendance").doc(currentUID).set({
        [dayKey]: { status: value, timestamp: Date.now() }
      }, { merge: true });
    }

    function renderMonth(monthIndex) {
      document.getElementById("monthTitle").textContent = `${months[monthIndex]} ${year}`;
      const tableHeadRow = document.getElementById("tableHeadRow");
      tableHeadRow.innerHTML = "<th>Date</th><th>Status</th>";

      const tbody = document.querySelector("#attendanceTable tbody");
      tbody.innerHTML = "";

      db.collection("attendance").doc(currentUID).get().then(doc => {
        const data = doc.data() || {};
        for (let d = 1; d <= daysInMonth[monthIndex]; d++) {
          const dayKey = `${d}-${months[monthIndex]}-${year}`;
          const tr = document.createElement("tr");
          const dateCell = document.createElement("td");
          dateCell.textContent = dayKey;
          tr.appendChild(dateCell);

          const statusCell = document.createElement("td");
          const select = document.createElement("select");
          ["","Present","Absent","CL","SL","OL"].forEach(opt => {
            const option = document.createElement("option");
            option.value = opt;
            option.textContent = opt === "" ? "--" : opt;
            if (data[dayKey] && data[dayKey].status === opt) option.selected = true;
            select.appendChild(option);
          });

          if (data[dayKey] && (Date.now() - data[dayKey].timestamp > 24*60*60*1000)) {
            select.disabled = true;
            select.title = "Locked after 24 hours";
          } else {
            select.addEventListener("change", e => setAttendance(dayKey, e.target.value));
          }

          statusCell.appendChild(select);
          tr.appendChild(statusCell);
          tbody.appendChild(tr);
        }
      });
    }

    document.getElementById("monthSelect").addEventListener("change", () => {
      renderMonth(parseInt(document.getElementById("monthSelect").value, 10));
    });
  </script>
</body>
</html>
